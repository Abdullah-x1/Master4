@model DSAR.ViewModels.RequestViewModel
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>ملخص الطلب</title>
    <link rel="stylesheet" href="~/css/confirm.css" asp-append-version="true" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            margin: 20px;
        }

        .summary-container {
            max-width: 1000px;
            margin: auto;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        h2 {
            border-bottom: 2px solid #ddd;
            padding-bottom: 8px;
            margin-top: 30px;
            color: #444;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }

            td.label {
                font-weight: bold;
                width: 30%;
                color: #333;
            }

        .buttons {
            margin-top: 40px;
            text-align: center;
        }

        .btn {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-submit {
            background-color: #28a745;
            color: white;
        }

        .btn-cancel {
            background-color: #dc3545;
            color: white;
            margin-right: 10px;
        }

        ul.description-list {
            list-style: none;
            padding: 0;
        }

            ul.description-list li {
                background-color: #f0f0f0;
                padding: 10px;
                margin-bottom: 8px;
                border-radius: 6px;
            }
    </style>
</head>
<body>
    <div class="summary-container">
        <h1>ملخص الطلب قبل التقديم</h1>

        <h2>بيانات مقدم الطلب</h2>
        <table>
            <tr><td class="label">الاسم:</td><td>@Model.Name</td></tr>
            <tr><td class="label">البريد الإلكتروني:</td><td>@Model.Email</td></tr>
            <tr><td class="label">الرسالة:</td><td>@Model.Message</td></tr>
        </table>

        <h2>معلومات الخدمة</h2>
        <table>
            <tr><td class="label">اسم الخدمة:</td><td>@Model.ServiceName</td></tr>
            <tr><td class="label">النوع والموقع:</td><td>@Model.ServiceTypeAndLocation</td></tr>
            <tr><td class="label">وصف الخدمة:</td><td>@Model.ServiceDescription</td></tr>
            <tr>
                <td class="label">هل هناك اعتماد على خدمة أخرى؟</td>
                <td>@((Model.HasDependency?.ToLower() == "true") ? "نعم" : "لا")</td>
            </tr>
            <tr><td class="label">تفاصيل الاعتماد:</td><td>@Model.DependencyDetails</td></tr>
            <tr><td class="label">رقم الإجراء:</td><td>@Model.ProcedureNumber</td></tr>
            <tr><td class="label">حد التكرار:</td><td>@Model.RepeatLimit</td></tr>
            <tr><td class="label">الرسوم:</td><td>@Model.Fees</td></tr>
            <tr><td class="label">المدن:</td><td>@Model.Cities</td></tr>
            <tr><td class="label">الجمهور المستهدف:</td><td>@Model.TargetAudience</td></tr>
        </table>

        <h2>المخرجات المتوقعة</h2>
        <table>
            <tr><td class="label">المخرج الأول:</td><td>@Model.ExpectedOutput1</td></tr>
            <tr><td class="label">المخرج الثاني:</td><td>@Model.ExpectedOutput2</td></tr>
            <tr><td class="label">النموذج المعتمد:</td><td>@Model.ApprovedTemplate</td></tr>
        </table>

        <h2>تفاصيل إضافية</h2>
        <table>
            <tr><td class="label">معلومات تفصيلية:</td><td>@Model.DetailedInfo</td></tr>
            <tr><td class="label">الشروط:</td><td>@Model.RequiredConditions</td></tr>
            <tr><td class="label">الإجراءات (Workflow):</td><td>@Model.Workflow</td></tr>
            <tr><td class="label">المرفقات المطلوبة:</td><td>@Model.UploadsRequired</td></tr>
            <tr><td class="label">الوثائق:</td><td>@Model.Documents</td></tr>
            <tr><td class="label">الجدول الزمني:</td><td>@Model.Timeline</td></tr>
            <tr><td class="label">هل يحتاج إلى نظام:</td><td>@Model.SystemNeeded</td></tr>
        </table>

        <h2>الوصف التفصيلي (Snapshot Descriptions)</h2>
        @if (Model.SnapshotDescriptions != null && Model.SnapshotDescriptions.Any())
        {
            <ul class="description-list">
                @foreach (var desc in Model.SnapshotDescriptions)
                {
                    <li>
                        <strong>@desc.Description1:</strong> @desc.Description2
                    </li>
                }
            </ul>
        }
        else
        {
            <p>لا توجد أوصاف حالياً.</p>
        }
        <div class="attachment-section">
            @if (Model.Attachment1Id != null && Model.Attachment1Id.Any())
            {
                <div class="text-info mt-1">
                    <i class="bi bi-paperclip me-1"></i> الملفات الحالية:
                    <ul class="attached-files">
                        @for (int i = 0; i < Model.Attachment1Id.Count; i++)
                        {
                            <li>
                                <a href="@Url.Action("DownloadSnapshotAttachment", "Request", new { attachmentId = Model.Attachment1Id[i] })" target="_blank">
                                    @Model.Attachment1Name[i]
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            }
            @if (Model.Attachment2Id != null && Model.Attachment2Id.Any())
            {
                <div class="text-info">
                    <i class="bi bi-paperclip me-1"></i>
                    <ul class="attached-files">
                        @for (int i = 0; i < Model.Attachment2Id.Count; i++)
                        {
                            <li>
                                <a href="@Url.Action("DownloadSnapshotAttachment", "Request", new { attachmentId = Model.Attachment2Id[i] })" target="_blank">
                                    @Model.Attachment2Name[i]
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            }

            @if (Model.UploadsRequiredAttachmentId != null && Model.UploadsRequiredAttachmentId.Any())
            {
                <div class="text-info mt-1">
                    <i class="bi bi-paperclip me-1"></i> الملفات الحالية للمرفقات المطلوبة:
                    <ul class="attached-files">
                        @for (int i = 0; i < Model.UploadsRequiredAttachmentId.Count; i++)
                        {
                            <li>
                                <a href="@Url.Action("DownloadSnapshotAttachment", "Request", new { attachmentId = Model.UploadsRequiredAttachmentId[i] })" target="_blank">
                                    @Model.UploadsRequiredName[i]
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            }

            @if (Model.DocumentsAttachmentId != null && Model.DocumentsAttachmentId.Any())
            {
                <div class="text-info mt-1">
                    <i class="bi bi-paperclip me-1"></i> الملفات الحالية لوثائق الدعم:
                    <ul class="attached-files">
                        @for (int i = 0; i < Model.DocumentsAttachmentId.Count; i++)
                        {
                            <li>
                                <a href="@Url.Action("DownloadSnapshotAttachment", "Request", new { attachmentId = Model.DocumentsAttachmentId[i] })" target="_blank">
                                    @Model.DocumentsName[i]
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            }
            @if (Model.WorkflowAttachmentId != null && Model.WorkflowAttachmentId.Any())
            {
                <div class="text-info mt-1">
                    <i class="bi bi-paperclip me-1"></i> الملفات الحالية لمسار العمل:
                    <ul class="attached-files">
                        @for (int i = 0; i < Model.WorkflowAttachmentId.Count; i++)
                        {
                            <li>
                                <a href="@Url.Action("DownloadSnapshotAttachment", "Request", new { attachmentId = Model.WorkflowAttachmentId[i] })" target="_blank">
                                    @Model.WorkflowName[i]
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            }


        </div>

        <div class="buttons">
            <button type="button" class="btn btn-cancel" onclick="history.back()">رجوع</button>
            <form method="post" asp-action="Request" asp-controller="Request" style="display:inline;">
                <button type="submit" class="btn btn-submit">تأكيد وتقديم</button>
            </form>
        </div>
    </div>

    @section Scripts {
        @await Html.PartialAsync("_ValidationScriptsPartial")
    }

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        @if (TempData["Error"] != null)
        {
                <text>
                    Swal.fire({
                        icon: 'info',
                        title: 'تنبيه',
                        text: '@Html.Raw(TempData["Error"])',
                        confirmButtonText: 'حسناً'
                    });
                </text>
        }
    </script>
</body>
</html>
